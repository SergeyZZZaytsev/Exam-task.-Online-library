{% extends "master.html" %}

{% block body %}
  {% if mode not in ["books", "magazines", "films", "search"] %}
    <h1 class="home-title"> Welcome to <span>Online Library</span></h1>
  {% elif mode in ["books", "magazines", "films"] %}
    <h2>{{ mode|capitalize }}</h2>
  {% elif mode == "search" %}
    <h2>Search results for "{{ query }}"</h2>
  {% endif %}

  {% if mode not in ["books", "magazines", "films", "search"] %}
    <form method="GET" action="/search" class="search-form">
      <input type="text" name="query" placeholder="Search in all sections..." value="{{ request.args.get('query', '') }}">
      <br>
      <button type="submit" class="search-btn">Search</button>
      <br>
      <button type="reset" class="clear-btn">Clear search</button>
    </form>

    <div class="instruction">
      <p>
        <strong>Online Library Service</strong> allows you to search for books, magazines, and films.
        You can use the main search bar on this page or perform a search within the corresponding section (Books, Magazines, Films).
      </p>
      <p>
        The service also enables you to add and delete books, magazines, or films from the existing database:
      </p>
      <ul>
        <li>To add a book, magazine, or film, go to the corresponding section and fill out the form in the top right corner.</li>
        <li>To delete a book, magazine, or film, find the desired item in the corresponding section and click the <em>"Delete"</em> button.</li>
      </ul>
    </div>
  {% endif %}

  {% if mode == "search" %}
    {% if results %}
      <ul>
        {% for section, title, link in results %}
          <li>[{{ section }}] <a href="{{ link }}">{{ title }}</a></li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No results found.</p>
    {% endif %}
  {% endif %}

  {% if mode == "books" %}
    <form method="GET" action="{{ request.path }}" class="search-form">
      <input type="text" name="search" placeholder="Search books..." value="{{ request.args.get('search', '') }}">
      <button type="submit" class="search-btn">Search</button>
      <button type="button" onclick="window.location.href='{{ request.path }}'">Clear search</button>
    </form>

    <table>
      <tr><th>Rank</th><th>Title</th><th>Author</th><th>Year</th><th>Action</th></tr>
      {% for book in items %}
        <tr>
          <td>{{ book.rank }}</td>
          <td>{{ book.title }}</td>
          <td>{{ book.author }}</td>
          <td>{{ book.year }}</td>
          <td>
            <form action="/delete_book/{{ book.id }}" method="GET" style="display:inline;">
              <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this book?')">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </table>

    <form action="/books" method="POST" class="add-form">
      <input name="title" placeholder="Title" required>
      <input name="author" placeholder="Author" required>
      <input type="number" name="year" placeholder="Year" required>
      <button type="submit">Add Book</button>
    </form>
  {% endif %}

  {% if mode == "magazines" %}
    <form method="GET" action="{{ request.path }}" class="search-form">
      <input type="text" name="search" placeholder="Search magazines..." value="{{ request.args.get('search', '') }}">
      <button type="submit" class="search-btn">Search</button>
      <button type="button" onclick="window.location.href='{{ request.path }}'">Clear search</button>
    </form>

    <table>
      <tr><th>Rank</th><th>Title</th><th>Issue</th><th>Publisher</th><th>Year</th><th>Action</th></tr>
      {% for magazine in items %}
        <tr>
          <td>{{ magazine.rank }}</td>
          <td>{{ magazine.title }}</td>
          <td>{{ magazine.issue }}</td>
          <td>{{ magazine.publisher }}</td>
          <td>{{ magazine.year }}</td>
          <td>
            <form action="/delete_magazine/{{ magazine.id }}" method="GET" style="display:inline;">
              <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this magazine?')">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </table>

    <form action="/magazines" method="POST" class="add-form">
      <input name="title" placeholder="Title" required>
      <input name="issue" placeholder="Issue" required>
      <input name="publisher" placeholder="Publisher" required>
      <input type="number" name="year" placeholder="Year" required>
      <button type="submit">Add Magazine</button>
    </form>
  {% endif %}

  {% if mode == "films" %}
    <form method="GET" action="{{ request.path }}" class="search-form">
      <input type="text" name="search" placeholder="Search films..." value="{{ request.args.get('search', '') }}">
      <button type="submit" class="search-btn">Search</button>
      <button type="button" onclick="window.location.href='{{ request.path }}'">Clear search</button>
    </form>

    <table>
      <tr><th>Rank</th><th>Title</th><th>Director</th><th>Year</th><th>Genre</th><th>Action</th></tr>
      {% for film in items %}
        <tr>
          <td>{{ film.rank }}</td>
          <td>{{ film.title }}</td>
          <td>{{ film.director }}</td>
          <td>{{ film.year }}</td>
          <td>{{ film.genre }}</td>
          <td>
            <form action="/delete_film/{{ film.id }}" method="GET" style="display:inline;">
              <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this film?')">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </table>

    <form action="/films" method="POST" class="add-form">
      <input name="title" placeholder="Title" required>
      <input name="director" placeholder="Director" required>
      <input type="number" name="year" placeholder="Year" required>
      <input name="genre" placeholder="Genre" required>
      <button type="submit">Add Film</button>
    </form>
  {% endif %}
{% endblock %}
